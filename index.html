<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URILEX - Modern Chat Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --discord-dark: #36393f;
            --discord-darker: #2f3136;
            --discord-darkest: #202225;
            --discord-gray: #4f545c;
            --discord-light-gray: #72767d;
            --discord-blue: #5865f2;
            --discord-green: #57f287;
            --discord-purple: #5865f2;
            --discord-text: #dcddde;
            --discord-text-muted: #a3a6aa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--discord-darkest);
            color: var(--discord-text);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Auth Screen */
        .auth-container {
            display: flex;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--discord-darkest) 0%, var(--discord-darker) 100%);
        }

        .auth-card {
            background: var(--discord-dark);
            border-radius: 8px;
            padding: 40px;
            width: 480px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .logo {
            margin-bottom: 24px;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, #5865f2, #57f287);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
        }

        .logo p {
            color: var(--discord-text-muted);
            margin-top: 8px;
            font-size: 1.1rem;
        }

        .auth-btn {
            background: var(--discord-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 20px;
            transition: all 0.2s;
        }

        .auth-btn:hover {
            background: #4752c4;
            transform: translateY(-2px);
        }

        .auth-btn i {
            font-size: 1.2rem;
        }

        .setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            display: none;
        }

        .setup-content {
            background: var(--discord-dark);
            padding: 30px;
            border-radius: 8px;
            width: 480px;
        }

        .setup-content h2 {
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            background: var(--discord-darkest);
            border: 1px solid var(--discord-gray);
            border-radius: 4px;
            color: var(--discord-text);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--discord-blue);
        }

        .btn {
            background: var(--discord-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #4752c4;
        }

        /* App Layout */
        .app-container {
            display: flex;
            width: 100%;
            height: 100%;
            display: none;
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: var(--discord-dark);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .user-profile {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--discord-darker);
            border-bottom: 1px solid var(--discord-gray);
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .online-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--discord-green);
        }

        .user-tag {
            font-size: 0.8rem;
            color: var(--discord-text-muted);
        }

        /* Navigation */
        .nav-section {
            padding: 16px 8px;
            border-bottom: 1px solid var(--discord-gray);
        }

        .nav-title {
            text-transform: uppercase;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--discord-text-muted);
            margin-bottom: 8px;
            padding: 0 8px;
        }

        .nav-item {
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .nav-item:hover, .nav-item.active {
            background: var(--discord-gray);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .friend-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .friend-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .friend-item:hover, .friend-item.active {
            background: var(--discord-gray);
        }

        .friend-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 8px;
            object-fit: cover;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .friend-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--discord-light-gray);
        }

        .friend-status.online {
            background: var(--discord-green);
        }

        .friend-activity {
            font-size: 0.75rem;
            color: var(--discord-text-muted);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--discord-darker);
        }

        /* Chat Header */
        .chat-header {
            padding: 16px;
            border-bottom: 1px solid var(--discord-gray);
            display: flex;
            align-items: center;
            height: 60px;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-title i {
            color: var(--discord-green);
        }

        .chat-name {
            font-weight: 600;
        }

        /* Chat Messages */
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .message {
            display: flex;
            margin-bottom: 20px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 16px;
            object-fit: cover;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: baseline;
            margin-bottom: 4px;
        }

        .message-sender {
            font-weight: 600;
            margin-right: 8px;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--discord-text-muted);
        }

        .message-text {
            line-height: 1.4;
        }

        .emoji {
            font-size: 1.2rem;
            margin: 0 2px;
            vertical-align: middle;
        }

        /* Message Input */
        .message-input-container {
            padding: 16px;
            background: var(--discord-gray);
        }

        .message-input {
            display: flex;
            background: var(--discord-dark);
            border-radius: 8px;
            padding: 8px;
        }

        .input-tools {
            display: flex;
            align-items: center;
            padding: 0 8px;
        }

        .input-tools i {
            color: var(--discord-text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
        }

        .input-tools i:hover {
            color: var(--discord-text);
            background: var(--discord-gray);
        }

        .message-input-field {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--discord-text);
            padding: 8px;
            font-size: 1rem;
            resize: none;
            height: 44px;
            max-height: 200px;
        }

        .message-input-field:focus {
            outline: none;
        }

        .send-btn {
            background: var(--discord-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            align-self: flex-end;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: #4752c4;
        }

        /* Friend Management */
        .friend-management {
            padding: 16px;
            background: var(--discord-darker);
        }

        .friend-search {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .friend-search input {
            flex: 1;
            padding: 12px;
            background: var(--discord-dark);
            border: 1px solid var(--discord-gray);
            border-radius: 4px;
            color: var(--discord-text);
            font-size: 1rem;
        }

        .search-btn {
            background: var(--discord-blue);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0 20px;
            cursor: pointer;
        }

        .requests-section {
            margin-top: 20px;
        }

        .section-title {
            font-size: 1.2rem;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .request-item {
            background: var(--discord-dark);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }

        .request-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            object-fit: cover;
        }

        .request-info {
            flex: 1;
        }

        .request-name {
            font-weight: 600;
        }

        .request-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            border: none;
        }

        .accept-btn {
            background: var(--discord-green);
            color: var(--discord-darkest);
        }

        .decline-btn {
            background: #f04747;
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 72px;
            }
            
            .user-info, .nav-text, .friend-info {
                display: none;
            }
            
            .user-profile {
                justify-content: center;
                padding: 16px 0;
            }
            
            .avatar {
                margin: 0;
            }
            
            .nav-item {
                justify-content: center;
            }
            
            .friend-item {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div class="auth-container" id="authScreen">
        <div class="auth-card">
            <div class="logo">
                <h1>URILEX</h1>
                <p>Modern chat platform for friends and communities</p>
            </div>
            <button class="auth-btn" id="googleSignInBtn">
                <i class="fab fa-google"></i>
                Sign In with Google
            </button>
        </div>
    </div>

    <!-- Username Setup Modal -->
    <div class="setup-modal" id="usernameModal">
        <div class="setup-content">
            <h2>Set Your Username</h2>
            <div class="form-group">
                <label for="username">Choose a username</label>
                <input type="text" id="username" class="form-control" placeholder="cool_username123">
            </div>
            <button class="btn" id="saveUsernameBtn">Save & Continue</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="app">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="user-profile">
                <img src="" alt="Profile" class="avatar" id="userAvatar">
                <div class="user-info">
                    <div class="username">
                        <span id="displayName">User</span>
                        <span class="online-status"></span>
                    </div>
                    <div class="user-tag" id="userTag">@username</div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Navigation</div>
                <div class="nav-item active">
                    <i class="fas fa-comment-alt"></i>
                    <span class="nav-text">Friends</span>
                </div>
                <div class="nav-item" id="addFriendBtn">
                    <i class="fas fa-user-plus"></i>
                    <span class="nav-text">Add Friend</span>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-title">Direct Messages</div>
                <div class="friend-list" id="friendList">
                    <!-- Friends will be populated here -->
                    <div class="friend-item">
                        <img src="https://i.pravatar.cc/40?img=1" alt="Friend" class="friend-avatar">
                        <div class="friend-info">
                            <div class="friend-name">
                                <span>Alex Johnson</span>
                                <span class="friend-status online"></span>
                            </div>
                            <div class="friend-activity">Online</div>
                        </div>
                    </div>
                    <div class="friend-item">
                        <img src="https://i.pravatar.cc/40?img=2" alt="Friend" class="friend-avatar">
                        <div class="friend-info">
                            <div class="friend-name">
                                <span>Sam Wilson</span>
                                <span class="friend-status"></span>
                            </div>
                            <div class="friend-activity">Offline</div>
                        </div>
                    </div>
                    <div class="friend-item">
                        <img src="https://i.pravatar.cc/40?img=3" alt="Friend" class="friend-avatar">
                        <div class="friend-info">
                            <div class="friend-name">
                                <span>Taylor Kim</span>
                                <span class="friend-status online"></span>
                            </div>
                            <div class="friend-activity">Playing Game</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Friend Management View -->
            <div class="friend-management" id="friendManagementView">
                <div class="friend-search">
                    <input type="text" placeholder="Enter username to add a friend">
                    <button class="search-btn">Search</button>
                </div>

                <div class="requests-section">
                    <div class="section-title">Pending Friend Requests</div>
                    <div class="request-list" id="requestList">
                        <!-- Requests will be populated here -->
                        <div class="request-item">
                            <img src="https://i.pravatar.cc/40?img=4" alt="User" class="request-avatar">
                            <div class="request-info">
                                <div class="request-name">Jordan Smith</div>
                                <div class="request-tag">@jordan_smith</div>
                            </div>
                            <div class="request-actions">
                                <button class="action-btn accept-btn">Accept</button>
                                <button class="action-btn decline-btn">Decline</button>
                            </div>
                        </div>
                        <div class="request-item">
                            <img src="https://i.pravatar.cc/40?img=5" alt="User" class="request-avatar">
                            <div class="request-info">
                                <div class="request-name">Casey Brown</div>
                                <div class="request-tag">@caseyb</div>
                            </div>
                            <div class="request-actions">
                                <button class="action-btn accept-btn">Accept</button>
                                <button class="action-btn decline-btn">Decline</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat View -->
            <div class="chat-view" id="chatView" style="display: none;">
                <div class="chat-header">
                    <div class="chat-title">
                        <i class="fas fa-circle"></i>
                        <span class="chat-name" id="chatFriendName">Alex Johnson</span>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <!-- Messages will be populated here -->
                    <div class="message">
                        <img src="https://i.pravatar.cc/40?img=1" alt="User" class="message-avatar">
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">Alex Johnson</span>
                                <span class="message-time">Today at 2:30 PM</span>
                            </div>
                            <div class="message-text">
                                Hey there! How are you doing today? 😄
                            </div>
                        </div>
                    </div>
                    
                    <div class="message">
                        <img src="" alt="User" class="message-avatar" id="currentUserAvatar">
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender" id="currentUserName">You</span>
                                <span class="message-time">Today at 2:32 PM</span>
                            </div>
                            <div class="message-text">
                                I'm doing great! Just finished working on this awesome chat app. <i class="emoji">🚀</i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="message">
                        <img src="https://i.pravatar.cc/40?img=1" alt="User" class="message-avatar">
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">Alex Johnson</span>
                                <span class="message-time">Today at 2:33 PM</span>
                            </div>
                            <div class="message-text">
                                That's amazing! I love the design. Can't wait to try it out! <i class="emoji">💯</i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="message-input-container">
                    <div class="message-input">
                        <div class="input-tools">
                            <i class="far fa-smile"></i>
                            <i class="fas fa-plus"></i>
                        </div>
                        <textarea class="message-input-field" placeholder="Message @Alex Johnson" id="messageInput"></textarea>
                        <button class="send-btn" id="sendMessageBtn">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC97fhomvutpUdF_Zt5nEX54RebVplEfNI",
            authDomain: "urilex-x.firebaseapp.com",
            databaseURL: "https://urilex-x-default-rtdb.firebaseio.com",
            projectId: "urilex-x",
            storageBucket: "urilex-x.firebasestorage.app",
            messagingSenderId: "902441215833",
            appId: "1:902441215833:web:9e7282bfcdcce2d05e8e48",
            measurementId: "G-QXK9V0236Y"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // DOM Elements
        const authScreen = document.getElementById('authScreen');
        const app = document.getElementById('app');
        const usernameModal = document.getElementById('usernameModal');
        const googleSignInBtn = document.getElementById('googleSignInBtn');
        const saveUsernameBtn = document.getElementById('saveUsernameBtn');
        const addFriendBtn = document.getElementById('addFriendBtn');
        const friendManagementView = document.getElementById('friendManagementView');
        const chatView = document.getElementById('chatView');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessageBtn');
        const userAvatar = document.getElementById('userAvatar');
        const displayName = document.getElementById('displayName');
        const userTag = document.getElementById('userTag');
        const currentUserAvatar = document.getElementById('currentUserAvatar');
        const currentUserName = document.getElementById('currentUserName');
        const chatFriendName = document.getElementById('chatFriendName');

        // State variables
        let currentUser = null;
        let selectedFriend = null;

        // Initialize the app
        function initApp() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    checkUsernameExists(user.uid);
                } else {
                    showAuthScreen();
                }
            });
        }

        // Check if username exists for user
        function checkUsernameExists(uid) {
            database.ref('users/' + uid).once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (userData && userData.username) {
                    loadUserData(userData);
                    showApp();
                } else {
                    showUsernameModal();
                }
            });
        }

        // Load user data to UI
        function loadUserData(userData) {
            // Set user profile
            if (currentUser.photoURL) {
                userAvatar.src = currentUser.photoURL;
                currentUserAvatar.src = currentUser.photoURL;
            }
            displayName.textContent = currentUser.displayName || 'User';
            userTag.textContent = '@' + (userData.username || 'username');
            currentUserName.textContent = 'You';
        }

        // Show authentication screen
        function showAuthScreen() {
            authScreen.style.display = 'flex';
            app.style.display = 'none';
            usernameModal.style.display = 'none';
        }

        // Show username modal
        function showUsernameModal() {
            authScreen.style.display = 'none';
            app.style.display = 'none';
            usernameModal.style.display = 'flex';
        }

        // Show main app
        function showApp() {
            authScreen.style.display = 'none';
            app.style.display = 'flex';
            usernameModal.style.display = 'none';
        }

        // Google Sign-In
        function googleSignIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log('Google sign-in successful', result.user);
                })
                .catch((error) => {
                    console.error('Google sign-in error:', error);
                    alert('Sign-in failed: ' + error.message);
                });
        }

        // Save username
        function saveUsername() {
            const usernameInput = document.getElementById('username');
            const username = usernameInput.value.trim();
            
            if (username.length < 3) {
                alert('Username must be at least 3 characters long');
                return;
            }
            
            if (currentUser) {
                const userRef = database.ref('users/' + currentUser.uid);
                userRef.set({
                    uid: currentUser.uid,
                    name: currentUser.displayName,
                    email: currentUser.email,
                    photoURL: currentUser.photoURL,
                    username: username,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                }).then(() => {
                    loadUserData({username});
                    showApp();
                }).catch((error) => {
                    console.error('Error saving username:', error);
                });
            }
        }

        // Toggle between chat and friend management
        function toggleView(view) {
            if (view === 'friend') {
                friendManagementView.style.display = 'block';
                chatView.style.display = 'none';
            } else if (view === 'chat') {
                friendManagementView.style.display = 'none';
                chatView.style.display = 'block';
            }
        }

        // Simulate sending a message
        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText === '') return;
            
            // In a real app, this would send to Firebase
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.innerHTML = `
                <img src="${currentUser.photoURL || 'https://i.pravatar.cc/40'}" alt="You" class="message-avatar">
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">You</span>
                        <span class="message-time">Just now</span>
                    </div>
                    <div class="message-text">${formatMessageWithEmojis(messageText)}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageElement);
            messageInput.value = '';
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simulate reply after 1-2 seconds
            setTimeout(() => {
                simulateReply();
            }, 1000 + Math.random() * 1000);
        }

        // Format message to replace emoji codes with emojis
        function formatMessageWithEmojis(text) {
            const emojiMap = {
                ':)': '😊',
                ':(': '😞',
                ':D': '😃',
                ':P': '😛',
                ';)': '😉',
                '<3': '❤️',
                ':rocket:': '🚀',
                ':fire:': '🔥',
                ':100:': '💯'
            };
            
            return text.replace(/:\)|:\(|:D|:P|;\)|<3|:rocket:|:fire:|:100:/g, match => {
                return `<i class="emoji">${emojiMap[match]}</i>`;
            });
        }

        // Simulate a reply from the friend
        function simulateReply() {
            const replies = [
                "That's awesome! I'm really impressed with what you've built.",
                "I love the design! The dark theme looks really sleek.",
                "How does the real-time messaging work? Is it using Firebase?",
                "This is so cool! Can't wait to show this to my friends.",
                "The UI looks professional. Are you using a framework?",
                "I noticed the emoji support is really smooth. Great job!",
                "The friend request system seems well thought out.",
                "How long did it take you to build this?",
                "I'd love to contribute if it's an open-source project!",
                "This is definitely better than some commercial chat apps I've used."
            ];
            
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            
            const messageElement = document.createElement('div');
            messageElement.className = 'message';
            messageElement.innerHTML = `
                <img src="${selectedFriend?.avatar || 'https://i.pravatar.cc/40?img=1'}" alt="${selectedFriend?.name || 'Friend'}" class="message-avatar">
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">${selectedFriend?.name || 'Friend'}</span>
                        <span class="message-time">Just now</span>
                    </div>
                    <div class="message-text">${formatMessageWithEmojis(randomReply)}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageElement);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Select a friend to chat with
        function selectFriend(friend) {
            selectedFriend = friend;
            chatFriendName.textContent = friend.name;
            toggleView('chat');
            
            // Clear chat and simulate loading messages
            chatMessages.innerHTML = '';
            
            // Add some initial messages
            const initialMessages = [
                {
                    sender: friend.name,
                    avatar: friend.avatar,
                    text: `Hey ${currentUser.displayName || 'there'}! How's it going?`,
                    time: 'Today at 2:30 PM'
                },
                {
                    sender: 'You',
                    avatar: currentUser.photoURL,
                    text: "I'm doing great! Just finished working on this awesome chat app. :rocket:",
                    time: 'Today at 2:32 PM'
                },
                {
                    sender: friend.name,
                    avatar: friend.avatar,
                    text: "That's amazing! I love the design. Can't wait to try it out! :100:",
                    time: 'Today at 2:33 PM'
                }
            ];
            
            initialMessages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message';
                messageElement.innerHTML = `
                    <img src="${msg.avatar || 'https://i.pravatar.cc/40'}" alt="${msg.sender}" class="message-avatar">
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">${msg.sender}</span>
                            <span class="message-time">${msg.time}</span>
                        </div>
                        <div class="message-text">${formatMessageWithEmojis(msg.text)}</div>
                    </div>
                `;
                chatMessages.appendChild(messageElement);
            });
            
            // Scroll to bottom
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }

        // Event Listeners
        googleSignInBtn.addEventListener('click', googleSignIn);
        saveUsernameBtn.addEventListener('click', saveUsername);
        addFriendBtn.addEventListener('click', () => toggleView('friend'));
        sendMessageBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Simulate clicking on a friend
        document.querySelectorAll('.friend-item').forEach(friend => {
            friend.addEventListener('click', () => {
                // Remove active class from all friends
                document.querySelectorAll('.friend-item').forEach(f => {
                    f.classList.remove('active');
                });
                
                // Add active class to clicked friend
                friend.classList.add('active');
                
                // Get friend data (in a real app, this would come from Firebase)
                const friendName = friend.querySelector('.friend-name span').textContent;
                const friendAvatar = friend.querySelector('.friend-avatar').src;
                
                selectFriend({
                    name: friendName,
                    avatar: friendAvatar
                });
            });
        });

        // Initialize the app on load
        window.addEventListener('load', initApp);
    </script>
</body>
</html>
